# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞

### –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç:
- üé® **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä—è–º–æ –∏–∑ Telegram (Nano Banana)
- üé¨ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ** - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–∑ Telegram (Kling)
- üìö **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞** - –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Ä–∞–±–æ—Ç
- ‚≠ê **–ë–∞–ª–∞–Ω—Å** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
- ü§ù **–†–µ—Ñ–µ—Ä–∞–ª—ã** - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
- üéì **–ê–∫–∞–¥–µ–º–∏—è** - –∑–∞–ø–∏—Å—å –≤ –ª–∏—Å—Ç –æ–∂–∏–¥–∞–Ω–∏—è
- ‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- üÜò **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤

### –ö—Ä–∞—Å–∏–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:
```
üé® LensRoom ‚Äî AI-—Å—Ç—É–¥–∏—è –≤ Telegram

–ü—Ä–∏–≤–µ—Ç, {–∏–º—è}! üëã

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é –ò–ò –ø—Ä—è–º–æ –≤ –±–æ—Ç–µ.

‚ú® –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç:
üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ (Nano Banana, FLUX, Imagen)
üé¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ (Kling, Veo 2)
üìö –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –≤–∞—à–∏—Ö —Ä–∞–±–æ—Ç
‚≠ê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º –∏ —Ç–∞—Ä–∏—Ñ–∞–º–∏
ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
```

## üìã –®–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 1Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

–û—Ç–∫—Ä–æ–π **Supabase SQL Editor** –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- Add bot_mode column to telegram_user_settings
ALTER TABLE IF EXISTS public.telegram_user_settings 
ADD COLUMN IF NOT EXISTS bot_mode TEXT;

COMMENT ON COLUMN public.telegram_user_settings.bot_mode 
IS 'Current bot interaction mode (gen_photo, gen_video, etc.)';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–ª–æ–Ω–∫–∞ `bot_mode` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Ç–∞–±–ª–∏—Ü—É `telegram_user_settings`.

---

### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook

#### –ê) –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ webhook:

```
https://lensroom.ru/api/telegram/webhook
```

#### –ë) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook —á–µ—Ä–µ–∑ BotFather:

```bash
# –ó–∞–º–µ–Ω–∏—Ç—å YOUR_BOT_TOKEN –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω
curl -X POST "https://api.telegram.org/botYOUR_BOT_TOKEN/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://lensroom.ru/api/telegram/webhook",
    "allowed_updates": ["message", "callback_query"]
  }'
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä:**

```
https://api.telegram.org/bot8239401027:AAFao47EOexUUOtl8xMSXjKTC7uv576Rovg/setWebhook?url=https://lensroom.ru/api/telegram/webhook
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "ok": true,
  "result": true,
  "description": "Webhook was set"
}
```

#### –í) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook:

```bash
curl "https://api.telegram.org/bot8239401027:AAFao47EOexUUOtl8xMSXjKTC7uv576Rovg/getWebhookInfo"
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```json
{
  "ok": true,
  "result": {
    "url": "https://lensroom.ru/api/telegram/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

---

### 3Ô∏è‚É£ –ù–∞–π—Ç–∏ –∏–º—è –±–æ—Ç–∞

–û—Ç–∫—Ä–æ–π [@BotFather](https://t.me/BotFather) –∏ –Ω–∞–π–¥–∏ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞.

**–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å —á–µ—Ä–µ–∑ API:**

```bash
curl "https://api.telegram.org/bot8239401027:AAFao47EOexUUOtl8xMSXjKTC7uv576Rovg/getMe"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "ok": true,
  "result": {
    "id": 123456789,
    "is_bot": true,
    "first_name": "LensRoom",
    "username": "lensroom_bot"  ‚Üê –≠–¢–û –¢–í–û–ô USERNAME
  }
}
```

---

### 4Ô∏è‚É£ –î–æ–±–∞–≤–∏—Ç—å username –≤ environment

–î–æ–±–∞–≤—å –≤ `/root/lensroom-v2/ecosystem.config.js`:

```javascript
env: {
  // ... existing vars ...
  TELEGRAM_BOT_USERNAME: 'lensroom_bot',  // ‚Üê ADD THIS
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ PM2:

```bash
cd /root/lensroom-v2
pm2 restart lensroom
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1Ô∏è‚É£ –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞

```
https://t.me/lensroom_bot
```

### 2Ô∏è‚É£ –ù–∞–∂–º–∏ `/start`

–î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –∫—Ä–∞—Å–∏–≤–æ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:

```
üé® –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ç–æ | üé¨ –°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ
üìö –ú–æ–∏ —Ä–∞–±–æ—Ç—ã   | ‚≠ê –ë–∞–ª–∞–Ω—Å
ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã     | üí≥ –ö—É–ø–∏—Ç—å ‚≠ê
üéì –ê–∫–∞–¥–µ–º–∏—è     | ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞    | üåê –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç
```

### 3Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–æ—Ç–æ

1. –ù–∞–∂–º–∏ **üé® –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ç–æ**
2. –û—Ç–ø—Ä–∞–≤—å –ø—Ä–æ–º–ø—Ç: `beautiful sunset over mountains`
3. –ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç: `üé® –°–æ–∑–¥–∞—é —Ñ–æ—Ç–æ... –≠—Ç–æ –∑–∞–π–º—ë—Ç ~30 —Å–µ–∫—É–Ω–¥`
4. –ö–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ, –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º ‚úÖ

### 4Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **üìö –ú–æ–∏ —Ä–∞–±–æ—Ç—ã** - –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- **‚≠ê –ë–∞–ª–∞–Ω—Å** - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
- **ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã** - –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
- **‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

---

## üîß Troubleshooting

### Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** `{"ok":false,"description":"Bad Request: bad webhook..."}`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω: `curl https://lensroom.ru/api/telegram/webhook`
2. –ü—Ä–æ–≤–µ—Ä—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
3. –£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π webhook: `curl -X POST "https://api.telegram.org/botYOUR_TOKEN/deleteWebhook"`

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç–ø—Ä–∞–≤–∏–ª `/start`, –Ω–æ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `pm2 logs lensroom --lines 50`
2. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `SITE_URL` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ env
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `TELEGRAM_BOT_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–æ–º–ø—Ç, –Ω–æ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –Ω–∞ —Å–∞–π—Ç–µ —á–µ—Ä–µ–∑ Telegram
2. –ü—Ä–æ–≤–µ—Ä—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â•4 ‚≠ê –¥–ª—è —Ñ–æ—Ç–æ)
3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ `KIE_API_KEY` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** `column "bot_mode" does not exist`

**–†–µ—à–µ–Ω–∏–µ:**
```sql
ALTER TABLE public.telegram_user_settings 
ADD COLUMN IF NOT EXISTS bot_mode TEXT;
```

---

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/menu` | –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/help` | –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| `/stop` | –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |

---

## üé® –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ

–§–∞–π–ª: `src/app/api/telegram/webhook/route.ts`

–§—É–Ω–∫—Ü–∏—è: `sendMainMenu()`

### –ò–∑–º–µ–Ω–∏—Ç—å –º–µ–Ω—é

–§–∞–π–ª: `src/app/api/telegram/webhook/route.ts`

–§—É–Ω–∫—Ü–∏—è: `menuKeyboard()`

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

–§–∞–π–ª: `src/app/api/telegram/webhook/route.ts`

–í —Ñ—É–Ω–∫—Ü–∏–∏ `POST()` –¥–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö `callback_data` –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥.

---

## ‚úÖ Checklist

- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (–∫–æ–ª–æ–Ω–∫–∞ `bot_mode`)
- [ ] Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
- [ ] Username –±–æ—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `ecosystem.config.js`
- [ ] PM2 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start`
- [ ] –ú–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–ë–æ—Ç:** https://t.me/lensroom_bot
- **Webhook:** https://lensroom.ru/api/telegram/webhook
- **Telegram Bot API:** https://core.telegram.org/bots/api
- **BotFather:** https://t.me/BotFather

---

**–ì–æ—Ç–æ–≤–æ! –¢–≤–æ–π –±–æ—Ç —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è AI-—Å—Ç—É–¥–∏—è –≤ Telegram! üéâ**
