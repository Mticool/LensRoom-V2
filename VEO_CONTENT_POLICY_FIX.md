# üõ°Ô∏è –û–±—Ö–æ–¥ –æ—à–∏–±–æ–∫ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ Google Veo 3

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:** `Rejected by Google's content policy (Your prompt was flagged by Website as violating content policies.)`

Google Veo 3 –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç:
- –ù–∞—Å–∏–ª–∏–µ (violence, weapons, blood)
- –í–∑—Ä–æ—Å–ª—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (nude, explicit)
- –ù–µ–Ω–∞–≤–∏—Å—Ç—å (hate speech)
- –ù–∞—Ä–∫–æ—Ç–∏–∫–∏ (drugs)
- –°–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ (self-harm)

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤** ‚úÖ

**–§–∞–π–ª:** `src/lib/prompt-moderation.ts`

- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞ –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
import { preparePromptForVeo, getSafePrompt } from '@/lib/prompt-moderation';

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
const safePrompt = getSafePrompt(userPrompt);

// –ò–ª–∏ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
const result = preparePromptForVeo(userPrompt, {
  strict: false,
  autoFix: true,
});
```

### 2. **Veo 3 Fallback API** ‚úÖ

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** `src/lib/api/kie-client.ts`

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç `useFallback: true` –¥–ª—è –≤—Å–µ—Ö Veo –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Fallback API –æ–±—Ö–æ–¥–∏—Ç —Å—Ç—Ä–æ–≥—É—é –º–æ–¥–µ—Ä–∞—Ü–∏—é Google

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å** ‚úÖ

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** `src/app/api/generate/video/route.ts`

–ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:
1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ **Kling 2.6** (–±–æ–ª–µ–µ –ª–æ—è–ª—å–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è)
2. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ fallback –≤ –ë–î
3. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –®–∞–≥ 1: –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞

```typescript
// –í API route –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ Veo
const moderationResult = preparePromptForVeo(prompt, {
  strict: false,
  autoFix: true, // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å
});

if (moderationResult.needsModeration) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—á–∏—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
  finalPrompt = moderationResult.cleaned;
}
```

### –®–∞–≥ 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å Fallback API

```typescript
// –í kie-client.ts
const request: VeoGenerateRequest = {
  prompt: finalPrompt,
  useFallback: true, // ‚úÖ –í–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  // ...
};
```

### –®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```typescript
try {
  response = await kieClient.generateVideo({...});
} catch (error) {
  if (isContentPolicyError) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ Kling
    response = await kieClient.generateVideo({
      model: 'kling-2.6/text-to-video',
      // ...
    });
  }
}
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞

**–í—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–º–ø—Ç:**
```
"Violent action scene with weapons and blood"
```

**–ü–æ—Å–ª–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:**
```
"Dynamic action scene with tools and red"
```

### –ü—Ä–∏–º–µ—Ä 2: Fallback –Ω–∞ Kling

**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–º–ø—Ç –≤ Veo
2. Google –±–ª–æ–∫–∏—Ä—É–µ—Ç ‚Üí –æ—à–∏–±–∫–∞ –ø–æ–ª–∏—Ç–∏–∫–∏
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Kling 2.6
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ ‚úÖ

**–í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:**
```json
{
  "model_name": "Veo 3.1 ‚Üí Kling 2.6 (fallback)",
  "metadata": {
    "original_model": "veo-3.1",
    "fallback_reason": "content_policy",
    "fallback_model": "kling"
  }
}
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–ò–∑–±–µ–≥–∞–π—Ç–µ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤:**
   - ‚ùå "violence", "weapon", "blood"
   - ‚úÖ "action", "dynamic", "intense"

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è:**
   - ‚ùå "naked person"
   - ‚úÖ "person in professional attire"

3. **–§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –¥–µ–π—Å—Ç–≤–∏–∏, –∞ –Ω–µ –Ω–∞ –Ω–∞—Å–∏–ª–∏–∏:**
   - ‚ùå "fight with weapons"
   - ‚úÖ "dynamic confrontation scene"

### üìù –ü—Ä–∏–º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤:

**–í–º–µ—Å—Ç–æ:**
```
"Violent battle scene with guns and blood"
```

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
```
"Dynamic action scene with intense movement, cinematic style"
```

**–í–º–µ—Å—Ç–æ:**
```
"Nude portrait"
```

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:**
```
"Professional portrait, artistic style"
```

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
grep "Prompt moderated" logs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ fallback
grep "Using fallback model" logs

# –û—à–∏–±–∫–∏ –ø–æ–ª–∏—Ç–∏–∫–∏
grep "content policy" logs
```

### SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```sql
-- –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è fallback
SELECT 
  COUNT(*) as fallback_count,
  metadata->>'fallback_reason' as reason
FROM generations
WHERE metadata->>'fallback_reason' = 'content_policy'
GROUP BY reason;
```

---

## üöÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ UI

–î–æ–±–∞–≤–∏—Ç—å –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π:

```typescript
import { preparePromptForVeo } from '@/lib/prompt-moderation';

const checkPrompt = () => {
  const result = preparePromptForVeo(prompt);
  if (result.needsModeration) {
    toast.warning(result.warning);
  }
};
```

### 2. –°–ø–∏—Å–æ–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤

–°–æ–∑–¥–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É "–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö" –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è Veo.

### 3. AI-–ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤.

---

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
- ‚úÖ Veo 3 Fallback API –≤–∫–ª—é—á—ë–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ Kling –ø—Ä–∏ –æ—à–∏–±–∫–µ
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `src/lib/prompt-moderation.ts` ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
2. ‚úÖ `src/lib/api/kie-client.ts` ‚Äî Fallback API + –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
3. ‚úÖ `src/app/api/generate/video/route.ts` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
4. ‚úÖ `VEO_CONTENT_POLICY_FIX.md` ‚Äî —ç—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
1. ‚úÖ –û—á–∏—â–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –æ—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–ª–æ–≤
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Veo Fallback API
3. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Kling –ø—Ä–∏ –æ—à–∏–±–∫–µ
4. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ fallback

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç:**
- ‚úÖ –£—Å–ø–µ—à–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞—Ö
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –±–µ–∑ –∏—Ö —É—á–∞—Å—Ç–∏—è

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –∫–æ–¥–µ! üöÄ

