# ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ - –ó–ê–í–ï–†–®–ï–ù–û

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ ‚úì

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —á–µ—Ä–µ–∑ grep:**
```bash
‚úÖ veo-3.1-fast: provider: 'laozhang'
‚úÖ sora-2: provider: 'laozhang' // Uses LaoZhang API
‚úÖ baseUrl: "https://api.laozhang.ai/v1"
```

**–§–∞–π–ª—ã:**
- `src/config/models.ts` (—Å—Ç—Ä–æ–∫–∏ 530, 704)

### 2. API –∫–ª–∏–µ–Ω—Ç LaoZhang ‚úì

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ Base URL: `https://api.laozhang.ai/v1` (—Å—Ç—Ä–æ–∫–∞ 200)
- ‚úÖ Authorization header: `Bearer ${LAOZHANG_API_KEY}`
- ‚úÖ Endpoint –¥–ª—è –≤–∏–¥–µ–æ: `/chat/completions` (—Å—Ç—Ä–æ–∫–∞ 431)
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ URL –∏–∑ `[download video](URL)` (—Å—Ç—Ä–æ–∫–∏ 456-464)
- ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π:
  - `veo-3.1-fast` ‚Üí `"veo-3.1-fast"` (LAOZHANG_MODELS.VEO_31_FAST)
  - `sora-2` (portrait, 10s) ‚Üí `"sora-2"` (LAOZHANG_MODELS.SORA_2)

**–§–∞–π–ª:** `src/lib/api/laozhang-client.ts`

### 3. UI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä ‚úì

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ:**
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è: `http://localhost:3000/create/studio?section=video&model=veo-3.1-fast`
- ‚úÖ –ú–æ–¥–µ–ª—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è: "Veo 3.1 Fast" —Å –±–µ–π–¥–∂–µ–º "FAST"
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è:
  - Prompt: "A cat walking on the street" ‚úì
  - Duration: 8s ‚úì (—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±–Ω–æ–≤–∏–ª–∞—Å—å –¥–æ 99 ‚≠ê)
  - Aspect Ratio: 16:9 ‚úì
  - Quality: 1080p ‚úì
- ‚úÖ –ö–Ω–æ–ø–∫–∞ Generate –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç—å—é: "Generate 99"

### 4. API Route –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚úì

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤ –∫–æ–¥–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: `if (modelInfo.provider === 'laozhang')` (—Å—Ç—Ä–æ–∫–∞ 701)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ë–î: `generations` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "queued" (—Å—Ç—Ä–æ–∫–∏ 463-491)
- ‚úÖ –í—ã–∑–æ–≤ LaoZhang: `videoClient.generateVideo()` (—Å—Ç—Ä–æ–∫–∏ 743-748)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Storage: bucket `generations`, –ø—É—Ç—å `${userId}/${fileName}` (—Å—Ç—Ä–æ–∫–∏ 762-777)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏: `status: 'success'`, `result_urls: [finalVideoUrl]` (—Å—Ç—Ä–æ–∫–∏ 781-788)

**–§–∞–π–ª:** `src/app/api/generate/video/route.ts`

### 5. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ‚úì

**–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- `[API] Video generation request to LaoZhang:` - —Å –ø–æ–ª–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Å—Ç—Ä–æ–∫–∞ 730)
- `[Video API] Request to LaoZhang:` - —Å baseUrl –∏ endpoint (—Å—Ç—Ä–æ–∫–∞ 424)
- `[API] Video storage upload:` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≥—Ä—É–∑–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 778)
- `[API] Updating generation record:` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î (—Å—Ç—Ä–æ–∫–∞ 785)

### 6. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚úì

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ API –∑–∞–≥—Ä—É–∑–∫–∏: `/api/library` —Å —Ñ–∏–ª—å—Ç—Ä–æ–º `type === 'video'` (—Å—Ç—Ä–æ–∫–∞ 128)
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ: `filtered = items.filter(i => i.type?.toLowerCase() === 'video')` (—Å—Ç—Ä–æ–∫–∞ 167)
- ‚úÖ URL –æ–±—Ä–∞–±–æ—Ç–∫–∞: signed URL –∏–∑ storage ‚Üí direct URL ‚Üí public URL

**–§–∞–π–ª—ã:**
- `src/app/api/library/route.ts`
- `src/app/library/LibraryClient.tsx`

## üìä –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ (–ø—Ä–æ–≤–µ—Ä–µ–Ω –≤ –∫–æ–¥–µ)

```
1. UI (VideoGeneratorLight/VideoGeneratorHiru)
   ‚Üì onGenerate callback
   ‚Üì StudioRuntime –∏–ª–∏ useGeneration hook
   ‚Üì POST /api/generate/video
   {
     prompt: "A cat walking on the street",
     model: "veo-3.1-fast",
     aspectRatio: "16:9",
     duration: 8,
     quality: "fast",
     mode: "t2v"
   }

2. API Route (route.ts:701)
   ‚Üì –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–µ–¥–∏—Ç–æ–≤
   ‚Üì –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ generations (status: "queued")
   ‚Üì –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞: modelInfo.provider === 'laozhang'

3. LaoZhang Client (laozhang-client.ts:371)
   ‚Üì POST https://api.laozhang.ai/v1/chat/completions
   {
     model: "veo-3.1-fast",
     messages: [{ role: "user", content: prompt }]
   }
   Headers: Authorization: Bearer ${LAOZHANG_API_KEY}

4. LaoZhang API
   ‚Üì –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
   {
     choices: [{
       message: {
         content: "[download video](https://...)"
       }
     }]
   }

5. API Route (route.ts:743-788)
   ‚Üì –ü–∞—Ä—Å–∏–Ω–≥ URL –∏–∑ –æ—Ç–≤–µ—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 458)
   ‚Üì –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ (—Å—Ç—Ä–æ–∫–∞ 754)
   ‚Üì –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Supabase Storage (bucket: generations) (—Å—Ç—Ä–æ–∫–∞ 762)
   ‚Üì –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ generations:
      status: "success"
      result_urls: [publicUrl] (—Å—Ç—Ä–æ–∫–∞ 785)

6. Library API (/api/library:128)
   ‚Üì –ó–∞–≥—Ä—É–∑–∫–∞ generations –¥–ª—è user_id
   ‚Üì –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è type === "video" (—Å—Ç—Ä–æ–∫–∞ 167)
   ‚Üì –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ signed URLs

7. LibraryClient (UI)
   ‚Üì –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–µ–æ –≤ –≥–∞–ª–µ—Ä–µ–µ "–ú–æ–∏ —Ä–∞–±–æ—Ç—ã"
   ‚Üì –ü–ª–µ–µ—Ä –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
```

## ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ API –∫–ª–∏–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ö–æ–¥
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ Storage —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ —Å LaoZhang API:**
- Veo 3.1 Fast ‚úì
- Sora 2 ‚úì
- Nano Banana ‚úì
- Nano Banana Pro ‚úì

**–î–ª—è –ø–æ–ª–Ω–æ–≥–æ E2E —Ç–µ—Å—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è:**
1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Telegram session)
2. –†–µ–∞–ª—å–Ω—ã–π `LAOZHANG_API_KEY` –≤ `.env.local`
3. –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ UI

**–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
- –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö: `tsx scripts/check-video-generation-db.ts --recent 1`
- –ë–∏–±–ª–∏–æ—Ç–µ–∫—É: `/library` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ
