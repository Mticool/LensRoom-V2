# ๐ ะะฐะบ ะะฐะดะตะฟะปะพะธัั LensRoom V2

## ๐ ะะฝัะพัะผะฐัะธั ะพ ะกะตัะฒะตัะต

**ะกะตัะฒะตั:** `root@104.222.177.29`  
**ะััั:** `/opt/lensroom/current`  
**PM2 ะัะพัะตััั:**
- `lensroom` - ะพัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต (ะฟะพัั 3002)
- `lensroom-previews-worker` - ะฒะพัะบะตั ะดะปั ะฟัะตะฒัั

**ะกะฐะนั:** https://lensroom.ru

---

## โก ะัััััะน ะะตะฟะปะพะน (ะะตะบะพะผะตะฝะดัะตััั)

### **ะะดะธะฝ ัะบัะธะฟั - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน:**

```bash
cd /Users/maratsagimov/Desktop/LensRoom.V2/lensroom-v2
bash ะะะะะะ.sh
```

**ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:**
- โ ะัะพะฒะตัะธั build ะปะพะบะฐะปัะฝะพ
- โ ะะพะดะบะปััะธััั ะบ ัะตัะฒะตัั
- โ ะะฐะณััะทะธั ะฟะพัะปะตะดะฝะธะน ะบะพะด (`git pull`)
- โ ะฃััะฐะฝะพะฒะธั ะทะฐะฒะธัะธะผะพััะธ (`npm ci`)
- โ ะกะพะฑะตััั production build
- โ ะะตัะตะทะฐะฟัััะธั PM2 ะฟัะพัะตััั
- โ ะะพะบะฐะถะตั ััะฐััั

---

## ๐ง ะะปััะตัะฝะฐัะธะฒะฝัะต ะกะฟะพัะพะฑั

### **ะะฐัะธะฐะฝั 1: ะะฐ ัะตัะฒะตัะต ะฒัััะฝัั**

```bash
# 1. ะะพะดะบะปััะธัััั ะบ ัะตัะฒะตัั
ssh root@104.222.177.29

# 2. ะะตัะตะนัะธ ะฒ ะฟัะพะตะบั
cd /opt/lensroom/current

# 3. ะะฑะฝะพะฒะธัั ะบะพะด
git pull origin main

# 4. ะะฐะฟัััะธัั ะดะตะฟะปะพะน ัะบัะธะฟั
bash scripts/deploy-production.sh
```

### **ะะฐัะธะฐะฝั 2: ะงะตัะตะท Git Push (ะตัะปะธ ะฝะฐัััะพะตะฝ remote)**

```bash
# ะะฐ ะปะพะบะฐะปัะฝะพะน ะผะฐัะธะฝะต
cd /Users/maratsagimov/Desktop/LensRoom.V2/lensroom-v2

# Push ะฝะฐ ัะตัะฒะตั (ะตัะปะธ ะฝะฐัััะพะตะฝ git remote)
git push production main

# ะะฐัะตะผ ะฝะฐ ัะตัะฒะตัะต ะฟัะธะผะตะฝะธัั ะธะทะผะตะฝะตะฝะธั
ssh root@104.222.177.29
cd /opt/lensroom/current
git pull
bash scripts/deploy-production.sh
```

---

## ๐ ะัะพะฒะตัะบะฐ ะะพัะปะต ะะตะฟะปะพั

### **1. ะัะพะฒะตัะธัั PM2 ััะฐััั:**

```bash
ssh root@104.222.177.29
pm2 status
```

ะะพะปะถะฝะพ ะฑััั:
```
โโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโ
โ id  โ name                       โ status  โ restart โ uptime  โ
โโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโค
โ 0   โ lensroom                   โ online  โ 0       โ 10s     โ
โ 1   โ lensroom-previews-worker   โ online  โ 0       โ 10s     โ
โโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโ
```

### **2. ะัะพะฒะตัะธัั ะปะพะณะธ:**

```bash
# ะัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
pm2 logs lensroom --lines 50

# ะะพัะบะตั ะฟัะตะฒัั
pm2 logs lensroom-previews-worker --lines 50

# ะขะพะปัะบะพ ะพัะธะฑะบะธ
pm2 logs --err --lines 100

# ะ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
pm2 logs
```

### **3. ะัะพะฒะตัะธัั ัะฐะนั:**

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต:
- **ะะปะฐะฒะฝะฐั:** https://lensroom.ru
- **ะะตะฝะตัะฐัะพั ัะพัะพ:** https://lensroom.ru/create
- **ะะธะฑะปะธะพัะตะบะฐ:** https://lensroom.ru/library

**ะัะพะฒะตัััะต ะฝะพะฒัะต ััะฝะบัะธะธ:**
- โ ะัะต 9 ะผะพะดะตะปะตะน ะฒ ะผะตะฝั "ะะธะทะฐะนะฝ"
- โ ะะตะฝะตัะฐัะธั ัะฐะฑะพัะฐะตั
- โ ะะฐะปะตัะตั ะฟะพะบะฐะทัะฒะฐะตั ะฟัะฐะฒะธะปัะฝัะต ัะพัะผะฐัั
- โ ะะฝะพะฟะบะธ ะฝะฐ ัะพัะพ ะฟะพัะฒะปััััั ะฟัะธ ะฝะฐะฒะตะดะตะฝะธะธ

---

## ๐ ะัะปะธ ะงัะพ-ัะพ ะะพัะปะพ ะะต ะขะฐะบ

### **ะัะบะฐัะธัั ะฝะฐ ะฟัะตะดัะดัััั ะฒะตััะธั:**

```bash
ssh root@104.222.177.29
cd /opt/lensroom/current

# ะัะบะฐัะธัั git ะฝะฐ 1 ะบะพะผะผะธั ะฝะฐะทะฐะด
git reset --hard HEAD~1

# ะะตัะตัะพะฑัะฐัั
npm ci
npm run build

# ะะตัะตะทะฐะฟัััะธัั
pm2 restart all --update-env
```

### **ะัะธััะธัั ะบัั ะธ ะฟะตัะตัะพะฑัะฐัั:**

```bash
ssh root@104.222.177.29
cd /opt/lensroom/current

# ะฃะดะฐะปะธัั .next ะธ node_modules
rm -rf .next node_modules

# ะะตัะตัััะฐะฝะพะฒะธัั ะธ ะฟะตัะตัะพะฑัะฐัั
npm ci
npm run build
pm2 restart all --update-env
```

### **ะัะพะฒะตัะธัั ะพัะธะฑะบะธ ัะฑะพัะบะธ:**

```bash
ssh root@104.222.177.29
cd /opt/lensroom/current

# ะะพะฟัะพะฑะพะฒะฐัั ัะพะฑัะฐัั ะฒัััะฝัั ั ะฒัะฒะพะดะพะผ ะพัะธะฑะพะบ
npm run build
```

---

## ๐ ะะพะปะตะทะฝัะต ะะพะผะฐะฝะดั

### **PM2 ะบะพะผะฐะฝะดั:**

```bash
# ะกัะฐััั ะฒัะตั ะฟัะพัะตััะพะฒ
pm2 status

# ะะพะณะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
pm2 logs

# ะขะพะปัะบะพ ะพัะธะฑะบะธ
pm2 logs --err

# ะะพะฝะธั (CPU/Memory)
pm2 monit

# ะะฝัะพัะผะฐัะธั ะพ ะฟัะพัะตััะต
pm2 describe lensroom

# ะะตัะตะทะฐะฟัััะธัั ั ะฝะพะฒัะผ env
pm2 restart all --update-env

# ะะตัะตะทะฐะฟัััะธัั ัะพะปัะบะพ ะพัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
pm2 restart lensroom

# ะััะฐะฝะพะฒะธัั ะฒะพัะบะตั (ะตัะปะธ ะฝัะถะฝะพ)
pm2 stop lensroom-previews-worker

# ะกะพััะฐะฝะธัั ะบะพะฝัะธะณััะฐัะธั
pm2 save
```

### **ะัะพะฒะตัะบะฐ ัะตัะฒะตัะฐ:**

```bash
# ะัะพะฒะตัะธัั ะฟะพัั 3002
netstat -tuln | grep 3002

# Curl test
curl http://localhost:3002

# ะัะพะฒะตัะธัั Nginx
nginx -t
systemctl status nginx
systemctl reload nginx
```

---

## โ ะงะตะบะปะธัั ะะตะฟะปะพั

- [ ] **ะะพะบะฐะปัะฝะพ:** Build ััะฟะตัะตะฝ (`npm run build`)
- [ ] **ะกะตัะฒะตั:** SSH ะดะพัััะฟ ัะฐะฑะพัะฐะตั
- [ ] **ะะตะฟะปะพะน:** ะกะบัะธะฟั ะทะฐะฟััะตะฝ (`bash ะะะะะะ.sh`)
- [ ] **ะัะพะฒะตัะบะฐ:** PM2 ััะฐััั `online`
- [ ] **ะัะพะฒะตัะบะฐ:** ะะพะณะธ ะฑะตะท ะพัะธะฑะพะบ
- [ ] **ะัะพะฒะตัะบะฐ:** ะกะฐะนั ะพัะบััะฒะฐะตััั
- [ ] **ะัะพะฒะตัะบะฐ:** ะะตะฝะตัะฐัะพั ัะฐะฑะพัะฐะตั
- [ ] **ะัะพะฒะตัะบะฐ:** ะัะต 9 ะผะพะดะตะปะตะน ะฒ ะผะตะฝั

---

## ๐ฏ ะะตะบะพะผะตะฝะดะฐัะธั

**ะกะฐะผัะน ะฟัะพััะพะน ัะฟะพัะพะฑ:**

```bash
bash ะะะะะะ.sh
```

ะญัะพั ัะบัะธะฟั ะฒัั ัะดะตะปะฐะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ! ๐

---

## ๐ ะะพะฝะธัะพัะธะฝะณ

ะะพัะปะต ะดะตะฟะปะพั ัะปะตะดะธัะต ะทะฐ:

1. **PM2 ััะฐััั:** `pm2 status` (ะดะพะปะถะตะฝ ะฑััั `online`)
2. **ะะพะณะธ:** `pm2 logs` (ะฝะต ะดะพะปะถะฝะพ ะฑััั ะพัะธะฑะพะบ)
3. **ะกะฐะนั:** https://lensroom.ru (ะดะพะปะถะตะฝ ะพัะบััะฒะฐัััั)
4. **ะะตะฝะตัะฐัะธั:** ะขะตััะธััะนัะต ะฒัะต ะผะพะดะตะปะธ

---

**๐ ะะพัะพะฒะพ ะบ ะดะตะฟะปะพั!**
